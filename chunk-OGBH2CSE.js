import{a as ne}from"./chunk-36HXAHSU.js";import{a as O}from"./chunk-IV4IEAPU.js";import{b as B,c as u,e as W,f as z,i as R,k as Z,l as J,m as Y,n as H,o as K,p as Q,q as X,r as ee,s as te,t as ie}from"./chunk-C6TDYET4.js";import{a as D,b as L}from"./chunk-AGWVRW6Z.js";import{a as j}from"./chunk-BDGLC6XZ.js";import{d as M}from"./chunk-VY2MS4WZ.js";import"./chunk-ZVBRR6AA.js";import{a as G,b as $}from"./chunk-BOTK6AKQ.js";import"./chunk-LYNREAIS.js";import"./chunk-74PP5OHW.js";import"./chunk-Q64FFBLU.js";import"./chunk-PZDGU76M.js";import{d as P}from"./chunk-6RETXR6U.js";import{i as A,m as q,p as U}from"./chunk-T5LH5EWW.js";import{Fb as h,Kb as i,Lb as n,Mb as p,Nb as x,Ob as w,Qb as b,Ub as v,Vb as c,_b as y,dc as N,ec as r,fb as o,fc as I,gb as C,ja as S,lc as T,mc as k,na as E,uc as V,vb as m,vc as F,xa as g,ya as _,yb as s}from"./chunk-7ATWILSR.js";function re(e,l){e&1&&(i(0,"div",43),r(1,"Username is required"),n())}function oe(e,l){if(e&1&&(i(0,"div",43),r(1,"Username must be at least "),i(2,"strong",44),r(3),n(),r(4," letters"),n()),e&2){let t=c().ngIf;o(3),I(t.getError("minlength").requiredLength)}}function ae(e,l){e&1&&(i(0,"div",43),r(1,"Only "),i(2,"strong",45),r(3,"_"),n(),r(4," and "),i(5,"strong",45),r(6,"."),n(),r(7," is allowed"),n())}function le(e,l){if(e&1&&(x(0),m(1,re,2,0,"div",42)(2,oe,5,1,"div",42)(3,ae,8,0,"div",42),w()),e&2){let t=l.ngIf;o(),s("ngIf",t.hasError("required")),o(),s("ngIf",t.hasError("minlength")),o(),s("ngIf",t.hasError("pattern"))}}function se(e,l){e&1&&(i(0,"div",43),r(1,"Password is required"),n())}function de(e,l){if(e&1&&(x(0),m(1,se,2,0,"div",42),w()),e&2){let t=l.ngIf;o(),s("ngIf",t.dirty&&t.hasError("required"))}}function pe(e,l){e&1&&(i(0,"div",43),r(1,"Age is requird"),n())}function me(e,l){e&1&&(i(0,"div",43),r(1,"Don't type letters"),n())}function ce(e,l){if(e&1&&(i(0,"div",43),r(1,"Must be "),i(2,"strong"),r(3),n(),r(4," digits"),n()),e&2){let t=c().ngIf;o(3),I(t.getError("minlength").requiredLength)}}function ue(e,l){if(e&1&&(x(0),m(1,pe,2,0,"div",42)(2,me,2,0,"div",42)(3,ce,5,1,"div",42),w()),e&2){let t=l.ngIf;o(),s("ngIf",t.hasError("required")),o(),s("ngIf",t.hasError("pattern")),o(),s("ngIf",t.hasError("minlength")&&t.hasError("pattern"))}}function fe(e,l){e&1&&(i(0,"div",43),r(1,"Password is required"),n())}function ge(e,l){e&1&&(i(0,"div",47),r(1,"At least 8 characters, using uppercase, lowercase, number nad symbol"),n())}function _e(e,l){if(e&1&&(x(0),m(1,fe,2,0,"div",42)(2,ge,2,0,"div",46),w()),e&2){let t=l.ngIf;o(),s("ngIf",t.dirty&&t.hasError("required")),o(),s("ngIf",t.dirty&&t.hasError("pattern"))}}function ve(e,l){if(e&1){let t=b();i(0,"svg-icon",15),v("click",function(){g(t);let d=c(2);return _(d.showNewPassword())}),n()}if(e&2){let t=c(2);y("src","",t.env.staticFileUrl,"/svg/eye-",t.toggleNewPassword.toString(),".svg")}}function xe(e,l){e&1&&(i(0,"div",49),r(1,"Not match"),n())}function we(e,l){if(e&1&&(x(0),m(1,xe,2,0,"div",48),w()),e&2){let t=l.ngIf;o(),s("ngIf",t.dirty&&t.hasError("passwordShouldMatch"))}}function Ce(e,l){if(e&1){let t=b();i(0,"svg-icon",15),v("click",function(){g(t);let d=c(2);return _(d.showNewPassword())}),n()}if(e&2){let t=c(2);y("src","",t.env.staticFileUrl,"/svg/eye-",t.toggleNewPassword.toString(),".svg")}}function he(e,l){if(e&1){let t=b();i(0,"div",1),p(1,"p-toast",3),i(2,"i",4),v("click",function(){g(t);let d=c();return _(d.goBack())}),n(),i(3,"form",5),v("ngSubmit",function(){g(t);let d=c();return _(d.updateUserInfo())}),i(4,"div",6),p(5,"input",7),i(6,"label",8),p(7,"i",9),r(8,"Username"),n(),m(9,le,4,3,"ng-container",10),n(),i(10,"div",11),p(11,"input",12),i(12,"label",13),p(13,"i",14),r(14,"Current password"),n(),m(15,de,2,1,"ng-container",10),i(16,"svg-icon",15),v("click",function(){g(t);let d=c();return _(d.showPassword())}),n()(),i(17,"div",16)(18,"div",17)(19,"div",18),p(20,"input",19),i(21,"label",20),p(22,"i",21),r(23,"Age"),n(),m(24,ue,4,3,"ng-container",10),n(),i(25,"div",18)(26,"select",22)(27,"option",23),r(28,"Male"),n(),i(29,"option",24),r(30,"Female"),n()(),i(31,"label",25),p(32,"i",26),r(33,"Gender"),n()()()(),i(34,"div",27)(35,"fieldset",28)(36,"legend",29),p(37,"i",30),r(38,"Change password"),n(),i(39,"div",31),p(40,"input",32,0),i(42,"label",33),r(43,"New password"),n(),m(44,_e,3,2,"ng-container",10)(45,ve,1,3,"svg-icon",34),n(),i(46,"div",35),p(47,"input",36),i(48,"label",37),r(49,"Repeat new password"),n(),m(50,we,2,1,"ng-container",10)(51,Ce,1,3,"svg-icon",34),n()()(),i(52,"button",38),p(53,"i",39),r(54," Apply Changes "),n(),i(55,"button",40),v("click",function(){g(t);let d=c();return _(d.deleteUser())}),p(56,"i",41),r(57," Delete Account "),n()()()}if(e&2){let t=N(41),a=c();o(3),s("formGroup",a.userInfo),o(6),s("ngIf",a.userInfo.controls.username),o(2),s("type",a.togglePassword?"text":"password"),o(4),s("ngIf",a.userInfo.controls.password.controls.currentPassword),o(),y("src","",a.env.staticFileUrl,"/svg/eye-",a.togglePassword.toString(),".svg"),o(8),s("ngIf",a.userInfo.controls.age),o(2),s("value",l.gender),o(14),s("type",a.toggleNewPassword?"text":"password"),o(4),s("ngIf",a.userInfo.controls.password.controls.newPassword),o(),h(t.value?45:-1),o(2),s("type",a.toggleNewPassword?"text":"password"),o(3),s("ngIf",a.userInfo.controls.password.controls.repeatNewPassword),o(),h(t.value?51:-1),o(),s("disabled",a.userInfo.invalid),o(3),s("disabled",a.userInfo.invalid)}}function be(e,l){e&1&&(i(0,"div",2),p(1,"i",50),n())}var Ge=(()=>{class e{constructor(t,a,d,f){this.message=t,this.fb=a,this.fbNotNull=d,this.location=f,this._api=S(O),this.togglePassword=!1,this.toggleNewPassword=!1,this.env=j,this.loading=!1,this.router=S(M),this.userInfo=this.fbNotNull.group({username:["",[u.required,u.minLength(2),u.pattern(/^[\w.]+$/)]],age:["",[u.required,u.minLength(2),u.pattern(/^[0-9]+$/)]],gender:["",[u.required]],password:this.fbNotNull.group({currentPassword:["",[u.required]],newPassword:["",[u.minLength(8),u.pattern(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/)]],repeatNewPassword:""},{validators:[ne]})})}updateUserInfo(){this.loading=!0,this.sub=this._api.updateUser(this.userId,this.userInfo.value).subscribe({next:()=>{this.loading=!1,this.message.add({severity:"success",summary:"Attempt successfull",detail:"Your profile updated",life:3e3}),setTimeout(()=>this.router.navigate(["projects/e-commerce/products"]),2e3)},error:()=>{this.loading=!1,this.message.add({severity:"error",summary:"Attempt failed",detail:"wrong password",life:3e3})}})}deleteUser(){confirm("Are you sure?")&&this.userInfo.controls.password.controls.currentPassword.valid&&(this.loading=!0,this._api.deleteUser(this.userId,this.userInfo.controls.password.controls.currentPassword.value).subscribe({next:()=>{this.loading=!1,this.message.add({severity:"info",summary:"Deleted",detail:"Account deleted successfully",life:3e3}),setTimeout(()=>this.router.navigate(["projects/e-commerce/register"]),3e3),localStorage.removeItem("token")},error:()=>{this.loading=!1,this.message.add({severity:"error",summary:"An error occured",detail:"Please try again",life:2e3})}}))}showPassword(){this.togglePassword=!this.togglePassword}showNewPassword(){this.toggleNewPassword=!this.toggleNewPassword}goBack(){this.location.back()}ngOnInit(){let t=localStorage.getItem("token");if(t){let a=t.split(".")[1],d=JSON.parse(atob(a)).userId;this.user$=this._api.getUserData(d),this.user$.subscribe(f=>{this.userId=d,this.userInfo.patchValue({username:f.username,age:f.age,gender:f.gender})}),this.userInfo.controls.password.controls.currentPassword.updateValueAndValidity(),this.userInfo.controls.password.controls.currentPassword.markAsDirty()}}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}static{this.\u0275fac=function(a){return new(a||e)(C(P),C(X),C(ee),C(A))}}static{this.\u0275cmp=E({type:e,selectors:[["app-profile"]],standalone:!0,features:[T([P]),k],decls:3,vars:4,consts:[["newPassword",""],[1,"w-full","h-full","flex","items-center","justify-center","pb-5","lg:pb-0"],[1,"loading"],["position","top-center"],[1,"pi","pi-arrow-left","fixed","top-0","left-0","lg:group-[top-1/3,left-1/4,text-3xl]","text-xl","text-basic-500","hover:group-[text-basic-200,scale-110]","p-4","cursor-pointer",3,"click"],["autocomplete","off",1,"bg-basic-1100","flex","flex-col","shadow-3","rounded-lg","w-68","p-5",3,"ngSubmit","formGroup"],[1,"flex","flex-col","gap-1","mt-5","mb-12","relative","inputWrapper"],["type","text","formControlName","username","autocomplete","off","placeholder"," ","name","username","id","username",1,"inputField"],["for","username",1,"inputLabel"],[1,"pi","pi-user","mr-1","text-lg"],[4,"ngIf"],["formGroupName","password",1,"flex","flex-col","gap-1","mb-14","relative","inputWrapper"],["name","currentPassword","placeholder"," ","autocomplete","new-password","formControlName","currentPassword",1,"inputField",3,"type"],["for","currentPassword",1,"inputLabel"],[1,"pi","pi-lock","mr-1","text-lg"],[1,"absolute","top-1","right-3","cursor-pointer","z-10",3,"click","src"],[1,"flex","flex-col","gap-1","mb-10"],[1,"flex","gap-2"],[1,"flex","flex-col","gap-1","w-1/2","relative","inputWrapper"],["type","text","formControlName","age","placeholder"," ","name","age",1,"inputField"],["for","age",1,"inputLabel"],[1,"pi","pi-calendar-times","mr-1","text-lg"],["name","gender","formControlName","gender",1,"inputSelect",3,"value"],["value","male"],["value","female"],["for","gender",1,"inputLabelSelect"],[1,"pi","pi-mars","mr-1","text-lg"],[1,"flex","flex-col","gap-1","mb-7"],["formGroupName","password",1,"w-10/12","self-center","border-2","border-basic-900","rounded-2xl","flex","flex-col","p-5","items-center","justify-center","gap-14"],[1,"p-2"],[1,"pi","pi-lock","mr-1","text-md"],[1,"flex","flex-col","gap-1","mt-2","relative","inputWrapper"],["name","newPassword","placeholder"," ","formControlName","newPassword",1,"inputField",3,"type"],["for","newPassword",1,"inputLabel","text-lg"],[1,"absolute","top-1","right-3","cursor-pointer","z-10",3,"src"],[1,"flex","flex-col","gap-1","mb-5","relative","inputWrapper"],["name","repeatNewPassword","placeholder"," ","formControlName","repeatNewPassword",1,"inputField",3,"type"],["for","repeatNewPassword",1,"inputLabel","text-lg"],["type","submit",1,"btn-primary","flex","gap-3","items-center","justify-center","mb-3","disabled:btn-primary-disabled",3,"disabled"],[1,"pi","pi-file-edit"],["type","button",1,"btn-error-secondary","disabled:btn-error-disabled","flex","items-center","justify-center","gap-3",3,"click","disabled"],[1,"pi","pi-trash"],["class","inputError",4,"ngIf"],[1,"inputError"],[1,"underline"],[1,"text-xl"],["class","text-error-500 text-md absolute -bottom-7 leading-none",4,"ngIf"],[1,"text-error-500","text-md","absolute","-bottom-7","leading-none"],["class","absolute -bottom-5 text-error-500 text-md leadnig-none",4,"ngIf"],[1,"absolute","-bottom-5","text-error-500","text-md","leadnig-none"],[1,"pi","pi-spin","pi-spinner","text-4xl"]],template:function(a,d){if(a&1&&(m(0,he,58,17,"div",1),V(1,"async"),m(2,be,2,0,"div",2)),a&2){let f;h((f=F(1,2,d.user$))?0:-1,f),o(2),h(d.loading?2:-1)}},dependencies:[U,te,R,K,Q,B,H,W,z,ie,Z,Y,J,$,G,q,L,D]})}}return e})();export{Ge as ProfileComponent};
