import{a as f}from"./chunk-BDGLC6XZ.js";import{a as k}from"./chunk-ZVBRR6AA.js";import{$ as b,Da as C,E as q,Ea as d,Uc as u,Vc as y,Wc as D,X as w,_ as $,a as h,b as l,da as x,ia as j,ja as m,n as v,qb as c,va as p}from"./chunk-7ATWILSR.js";function g(a,s){!s?.injector&&p(g);let t=s?.injector??m(C),e=new v(1),r=D(()=>{let i;try{i=a()}catch(o){y(()=>e.error(o));return}y(()=>e.next(i))},{injector:t,manualCleanup:!0});return t.get(d).onDestroy(()=>{r.destroy(),e.complete()}),e.asObservable()}function I(a,s){let t=!s?.manualCleanup;t&&!s?.injector&&p(I);let e=t?s?.injector?.get(d)??m(d):null,r=O(s?.equal),i;s?.requireSync?i=c({kind:0},{equal:r}):i=c({kind:1,value:s?.initialValue},{equal:r});let o=a.subscribe({next:n=>i.set({kind:1,value:n}),error:n=>{if(s?.rejectErrors)throw n;i.set({kind:2,error:n})}});if(s?.requireSync&&i().kind===0)throw new b(601,!1);return e?.onDestroy(o.unsubscribe.bind(o)),u(()=>{let n=i();switch(n.kind){case 1:return n.value;case 2:throw n.error;case 0:throw new b(601,!1)}},{equal:s?.equal})}function O(a=Object.is){return(s,t)=>s.kind===1&&t.kind===1&&a(s.value,t.value)}var V=(()=>{class a{constructor(t){this._http=t,this.baseUrl=`${f.ecommerce_api_url}/cart`,this.userId=c(void 0),this.cartItems=c([]),this.cartCount=u(()=>this.cartItems().reduce((e,r)=>e+r.quantity,0)),this.subTotal=u(()=>this.cartItems().reduce((e,r)=>e+r.price*r.quantity,0)),this.taxFee=u(()=>Math.round(this.subTotal()*20)/100),this.deliveryFee=u(()=>this.subTotal()<100&&this.totalWeight()<100?5:this.subTotal()<100&&this.totalWeight()>100?10:this.totalWeight()>100&&this.subTotal()>100?5:0),this.totalWeight=u(()=>this.cartItems().reduce((e,r)=>e+r.weight*r.quantity,0)),this.totalPrice=u(()=>this.subTotal()+this.taxFee()+this.deliveryFee()),this.getCart$=g(this.userId).pipe(q(Boolean),w(e=>this._http.get(`${this.baseUrl}/${e}`).pipe($(r=>{r.order&&this.cartItems.set(r.order)})))),this.getCart=I(this.getCart$,{initialValue:{}})}addToCart(t,e){let r=this.cartItems().findIndex(i=>i.productId==e.productId);return r<0?this.cartItems.update(i=>[...i,e]):this.cartItems.update(i=>[...i.slice(0,r),l(h({},i[r]),{quantity:i[r].quantity+1}),...i.slice(r+1)]),this._http.post(`${this.baseUrl}/${t}`,e)}purchase(t,e){return this._http.post(`${this.baseUrl}/purchase/${t}`,{purchased:e})}deleteProduct(t,e){return this.cartItems.update(r=>r.filter(i=>i.productId!==t)),this._http.patch(`${this.baseUrl}/${e}/delete/${t}`,{productId:t})}increaseQuantity(t,e){return this.cartItems.update(r=>r.map(i=>i.productId==t?l(h({},i),{quantity:i.quantity+1}):i)),this._http.patch(`${this.baseUrl}/${e}/${t}/increase`,{quantity:1})}decreaseQuantity(t,e){let r=this.cartItems().findIndex(o=>o.productId==t);return this.cartItems()[r].quantity>1?this.cartItems.update(o=>o.map(n=>n.productId==t?l(h({},n),{quantity:n.quantity-1}):n)):this.cartItems.update(o=>o.filter(n=>n.productId!==t)),this._http.patch(`${this.baseUrl}/${e}/${t}/decrease`,{quantity:1})}isProductInCart(t){return this.cartItems().find(e=>e.productId==t)}getOrderHistory(t){return this._http.get(`${f.ecommerce_api_url}/${t}/order-history`)}setUserId(t){this.userId.set(t)}static{this.\u0275fac=function(e){return new(e||a)(j(k))}}static{this.\u0275prov=x({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{V as a};
